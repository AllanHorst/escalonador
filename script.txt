angular.module('myApp', [])

.controller('myController', function($scope) {
	$scope.listaOrdem = []
	$scope.clicar = function() {
		var lista = [7, 4, 2, 2];
		var q = 2;
		$scope.listaOrdem = $scope.ordenar(lista, q);
		
	}

	$scope.listaTotalEspera = [];

	$scope.ordenar = function(listaProcesso, quantum) {
		$scope.listaProcesso = listaProcesso;
		var lista = angular.copy(listaProcesso);
		var listaOrdem = [];
		$scope.maisLista = []

		var ciclo = -(quantum)
		processar = true;
		var ultimoCiclo = 0
		var listaUltimoCiclo = []

		while(processar) {
				
			processar = false;
			for (var i = 0; i < lista.length; i++) {
				$scope.maisLista.push({
					'id': i,
					'valor': lista[i]
				})


				if (lista[i] == 0) {
					continue;
				}

				processar = true;
				
				var valor;
				if (lista[i] >= quantum) {
					ciclo += quantum;
					valor = quantum
				} else if (lista[i] > 0 && lista[i] < quantum) {
					valor = lista[i]
					ciclo += lista[i];
				} 
				lista[i] -= valor;  

				listaOrdem.push({
					'id'   : i,
					'nome' : 'p'+(i+1),
					'ciclo': ciclo,
					'finalCiclo': listaUltimoCiclo[i] == undefined ? 0 : listaUltimoCiclo[i]
				});

				var ultimo;
				if (listaUltimoCiclo[i] == null) {
					listaUltimoCiclo.push(ciclo)
					ultimo = 0
				} else {
					ultimo = listaUltimoCiclo[i];
				}
				var total = ciclo - ultimo

				somarTotal(total, i);

				listaUltimoCiclo[i] = ciclo + valor
			}
		}

		return listaOrdem;
	}

	function somarTotal(valor, id) {
		var encontrou = false;
		for (var i = 0; i < $scope.listaTotalEspera.length; i++) {
			let item = $scope.listaTotalEspera[i]
			if (item.id == id) {
				encontrou = true;
				$scope.listaTotalEspera[i].valor += valor
			}
		}

		if (!encontrou) {
			$scope.listaTotalEspera.push({
				'id': id,
				'valor': valor
			})
		}

	}

})
